```{r load-packages, message = FALSE}
library(tidyverse)
library(broom)
library(readr)
library(ggridges)
library(ggplot2)
library(usmap)
library(dplyr)
library(tigris)
library(stringr)
install.packages("leaflet")
library(leaflet)
library(sf)
```

```{r analysis}
victims_incidents <- read_csv("../data/victims_incidents.csv")
glimpse(victims_incidents)
```

``` {r incidents_state_map}
plot_usmap(data = incident_count, values = "incident_total", include = .south_region, color = "black", exclude = c("OK", "KY", "WV", "MD", "DE", "DC"), labels = TRUE) + 
  scale_fill_continuous(low = "white", high = "red", name = "Incident Count") + 
  labs(title = "Incident Count By State")+
  theme(legend.position = "right")
# colorblind friendly pallet
```

```{r incidents_count_by_state}
victims_incidents %>%
  group_by(state) %>%
  summarise(total_incidents = n()) %>%
  arrange(desc(total_incidents)) %>% 
  print()
```

``` {r incidents_alabama_counties}
fips_data <- tigris::counties(state = "Alabama", class = "sf") %>%
  select(fips = GEOID, county = NAME)

alabama_incidents_fix <- victims_incidents %>%
  filter(state == "Alabama") %>%
  mutate(county = str_replace(county, " County", "")) %>%  # because county names don't match fips data
  group_by(county) %>%
  summarise(incident_count = n(), .groups = 'drop')

alabama_incidents <- alabama_incidents_fix %>%
  left_join(fips_data, by = "county")

 sorted_alabama <- alabama_incidents %>% 
  arrange(desc(incident_count)) %>% 
 print(sorted_alabama)
 
plot_usmap(regions = "counties", data = alabama_incidents, values = "incident_count", include = "AL", color = "black") +
 scale_fill_continuous(low = "white", high = "red", name = "Incidents Count", na.value = "white") +
  labs(title = "Number of Incidents by County in Alabama",
       subtitle = "Of 203 total incidents in the state") +
  theme(legend.position = "right")
```

``` {r leaflet-trial}
all_counties_map <- victims_incidents %>% 
  mutate(county = str_replace(county, " County", "")) %>%  # because county names don't match fips data
  group_by(state, county) %>%
  summarise(incident_count = n(), .groups = 'drop') %>% 
  arrange(state, county)

counties_data <- tigris::counties(state = c("AL", "AR", "FL", "GA", "LA", "MS", "NC", "TN", "TX", "VA"), class = "sf")


counties_data <- tigris::counties(state = c("AL", "AR", "FL", "GA", "LA", "MS", "NC", "TN", "TX", "VA"), class = "sf") %>%
  select(GEOID = GEOID, county = NAME, state = NAME)

states<-list_states(c("AL", "AR", "FL", "GA", "LA", "MS", "NC", "TN", "TX", "VA"), sorted = TRUE)
```