---
title: "Analysis of Racial Violence in the American South"
author: "MEG Team: Esme McDonald, Gus Rivers-McHugh, Maxie Langenberg"
output: github_document
---

This document should contain a detailed account of the data clean up for your data and the design choices you are making for your plots. For instance you will want to document choices you've made that were intentional for your graphic, e.g. color you've chosen for the plot. Think of this document as a code script someone can follow to reproduce the data cleaning steps and graphics in your handout.

```{r load-packages, message = FALSE}
library(tidyverse)
library(broom)
library(tidyverse)
library(readr)
library(ggridges)
library(ggplot2)
library(usmap)
library(dplyr)
library(tigris)
library(stringr)
library(leaflet)
library(sf)
library(visdat)
library(naniar)
library(UpSetR)
library(devtools)
#devtools::install_github("hrbrmstr/streamgraph")
library(RColorBrewer)
library(viridis)
```

## Data Clean Up Steps for Overall Data

### Step 1: Uploading main dataset and FIPS geographic data
```{r upload data}
victims_incidents <- read_csv("../data/victims_incidents.csv")

fips_data <- tigris::counties(state = "Alabama", class = "sf") %>%
  select(fips = GEOID, county = NAME) #load fips data
``` 

### Step 2: Adding a "perp_group" column based on the four individual true/false columns for perp type. 

```{r merge-perp-groups}
victims_incidents <- victims_incidents %>%
  mutate(perp_group = case_when(
    perp_group_police == TRUE ~ "police",
    perp_group_posse == TRUE ~ "posse",
    perp_group_hate == TRUE ~ "hate",
    perp_group_mob == TRUE ~ "mob",
    TRUE ~ NA_character_
  ))
```

### Step 3: Create a count of incident total by each state 
``` {r incidents_state_map}
incident_count <- victims_incidents %>%
  group_by(state) %>%
  summarize(incident_total = n())
```



## Plots

#### Final Plot 1: Incident count by perpetrator group and year

```{r year_perp_group_bar}

victims_incidents <- victims_incidents %>% 
  drop_na(perp_group)

victims_incidents$perp_group <- factor(victims_incidents$perp_group, levels = c("posse", "mob", "hate", "police"))

red_palette <- viridis(4, option = "F", begin = 0.2, end = 0.9)
red_palette <- rev(red_palette)

ggplot(victims_incidents, aes(
  incident_year_range_end, fill = perp_group)) +
  geom_bar() +
  labs(
    title = "Deaths by racial violence by year and perpetrator type",
    subtitle = "Of reported incidents in the American South between the years 1930 and 1954",
    y = "Death Count",
    x = "Year"
  ) +
  scale_fill_manual(
    name = "Perpetrator Group",
    labels = c("Posse", "Mob", "Hate Group", "Police"),
    values = red_palette
  ) +
  theme_minimal()+
  theme(
    panel.background = element_rect(fill = "#ebebeb"), 
    legend.position = "right") 

#to save image
ggsave("BARyear_perp_final.png", width = 8, height = 5)
```


### Plot 2:

```{r spaghetti plot}

data <- victims_incidents %>%
  filter(state %in% c("Alabama", "Arkansas", "Louisiana", "Mississippi", "North Carolina", "South Carolina", "Tennessee", "Texas", "Virginia")) |>
  mutate(year = incident_year_range_beg) |>
  group_by(year, state, sex) |>
  summarize(n = n())

data %>%
  drop_na(sex) |>
  ggplot( aes(x=year, y=n, group=state, color=state)) +
    geom_line(alpha = .9) +
    scale_color_viridis_d() +
    geom_vline(xintercept = 1945, linetype = "dotted", color = "red") +
  geom_vline(xintercept = 1951, linetype = "dotted", color = "red") +
  annotate("rect", 
  xmin = 1945, 
  xmax = 1951, 
  ymin = 5, 
  ymax = 20, 
  alpha = 0.2, 
  fill = "red") +
  geom_text(x = 1939, y = 20, label = "Birmingham Bombings", color = "purple", show.legend  = FALSE) +
 labs( x = "Year", y = "Death Count") +
   theme(
      plot.title = element_text(size=15)) +
     ggtitle("Anti-Black Deaths by State from 1930-1954")
   #   theme_ipsum()
      
ggsave("SpaghettiPlot.png", width = 8, height = 5)
```

### Plot 3: ___________

Add more plot sections as needed. Each project should have at least 3 plots, but talk to me if you have fewer than 3.

### Plot 4: ___________ 


